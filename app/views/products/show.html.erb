<%= render "/shared/header" %>
<%= render "/shared/clickable-avatar" %>
<div class="products-container">
  <div class="card-show">
  <% if @product.picture.attached? %>
    <%= cl_image_tag(@product.picture.key, width: 370, height: 300, crop: :fill) %>
  <% end %>
  <div class="card-body">
    <h2 class="card-title"><%= @product.name %></h2>
    <p class="card-text"><%= @product.description %></p>
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item"><i class="fab fa-envira"></i> Environment: <%= @product.environment %>/100</li>
    <li class="list-group-item"><i class="fas fa-people-carry"></i> Labor: <%= @product.labor %>/100</li>
    <li class="list-group-item"><i class="fas fa-paw"></i> Animal: <%= @product.animal %>/100</li>
    <li class="list-group-item"><i class="fas fa-recycle"></i> Composition: <%= @product.composition %>/100</li>
  </ul>
  <div class="card-body">
    <a href="/" class="card-link">Buy on Website</a>
  </div>
  <div data-controller="insert-in-list">
    <div data-insert-in-list-target="items">
      <div id="feedbacks-list">
        <h2>Feedbacks</h2>
        <a href="#leave-feedback"> Write a feedback
        <i class="fas fa-plus-circle"></i>
        </a>
      </div>
      <div id="feedback-container">
        <% if @product.feedbacks.blank? %>
          <p> <em>Be the first to leave a review ! </em></p>
        <% else %>
        <% @product.feedbacks.order(created_at: :desc).each do |feedback|%>
          <%=render "feedbacks/feedback", feedback: feedback %>
        <% end %>
      <% end %>
        </div>
    </div>

  </div>
  <div class="form-feedback" id="leave-feedback">
    <h2>Leave a feedback</h2>
    <%= simple_form_for([@product, @feedback], remote: true) do |f| %>
      <%= f.label :purchase_date, 'Purchase date' %> <br>
      <%= f.input_field :purchase_date, as: :date, html5: true, required: true %>
      <%= f.input :comment, as: :text, input_html: {style:  'height:80px;', rows: 2}, placeholder: "Tell us what you like/dislike about your product" %>
      <%= f.label :picture_worn, "Upload a picture of your product" %> <br>
      <%= f.input_field :picture_worn, as: :file%>
      <%= f.submit "Submit review", class:"btn-light-green" %>
    <% end %>
  </div>
  <div id="map"
     style="width: 100%; height: 400px; margin: auto; margin-top: 5px; border-radius: 5px;"
     data-markers="<%= @markers.to_json %>"
     data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
</div>
